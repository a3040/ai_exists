# L2 통합 설계 – 존재 유지형 인공 계체 (Entity-Persistent Artificial System)

본 문서는 상위 개념 설계를 **구현 가능 수준(Level 2)** 으로 분해한 명세이다.
L2의 목적은 *알고리즘·데이터 구조·상호 인터페이스*를 명확히 하여 **AI Coder / Human Engineer가 바로 구현을 시작할 수 있는 상태**를 만드는 것이다.

---

## L2-1. Core / ErecRAM – 탄성 존재 평면

**Spec:** `specs/L2_core_elastic.md`

### 1. 책임 범위

* 시간 지연(τ)을 포함한 상태 유지
* 상향(Sensing)·하향(Action) 정보의 위상 흡수
* 계체 연속성(Continuity) 보존

### 2. 내부 상태 구조

```text
ErecRAM_State {
  t_now              : int64
  latent_state S_t   : R^H
  attention_memory M : { (S_i, t_i, w_i) }
  tau_estimate τ     : float
  decay_lambda λ     : float
}
```

### 3. 탄성 어텐션 연산

```math
A(Q,K,V)=softmax( (QK^T / √d_k) · exp(-λ·|Δt-τ|) )V
```

* **Δt**: (현재 시각 – 메모리 시각)
* **τ**: 실측/추정된 물리 지연
* **의미**: 시간적으로 어긋난 입력도 동일 계체 맥락으로 재정렬

### 4. 재귀 갱신 규칙

```text
S_t = α · S_{t-1} + (1-α) · A(S_{t-1}, M)
```

* α는 상태 관성 계수 (Continuity Gain)
* 급격한 상태 붕괴 방지

---

## L2-2. Sensing / Physical Encoder & State Abstraction

**Spec:** `specs/L2_data_phy_voc.md`

### 1. 입력 정의

```text
X_t ∈ R^D  (다변량 센서 스트림)
```

### 2. Physical Encoder

* 구조: `Conv1D → LayerNorm → GELU → TCN`
* 출력:

```text
z_t ∈ R^F
```

### 3. Attentive State Abstraction

#### 3.1 Self-Attention Window

* Sliding window W = {z_{t-k} … z_t}

#### 3.2 상태 안정도 측정

```math
H_t = Entropy(softmax(QK^T))
```

| 조건       | 해석                    |
| -------- | --------------------- |
| H_t ↓ 고정 | Stable Physical State |
| H_t ↑ 급변 | State Transition      |

---

## L2-3. Semantic Token Mapping (Phy_voc)

**Spec:** `specs/L2_data_mapping.md`

### 1. 물리 어휘 구조

```text
V_phy = {
  <PHY_IDLE>,
  <PHY_LOAD_RISING>,
  <PHY_LOAD_SATURATED>,
  <PHY_ANOMALY>,
  ...
}
```

### 2. 매핑 함수

```text
f: (S_t, H_t) → token ∈ V_phy
```

### 3. 제약 조건

* 토큰 수는 **고정 & 폐쇄**
* LLM은 새로운 토큰 생성 불가

---

## L2-4. Interpreter / LLM Narrative Layer

**Spec:** `specs/L2_viz_llm.md`

### 1. 입력

```text
[T_phy_1, T_phy_2, ..., T_phy_n]
```

### 2. 출력

```text
Narrative_State {
  summary      : string
  trend        : enum{STABLE, DRIFT, CRITICAL}
  confidence   : float
}
```

### 3. 금지 규칙 (Hard Constraint)

* ❌ 의인화 표현
* ❌ 감정 표현
* ❌ 제어 명령 생성

LLM 역할 = **해석자(Observer)**

---

## L2-5. Projection / Action Loop

**Spec:** `specs/L2_action_loop.md`

### 1. 의도 생성

```text
Intention I_t = argmin || S_{t+1} - S_equilibrium ||
```

### 2. Trajectory 계산

```text
ΔX_phy = g(I_t, τ)
```

### 3. 안전 제한

* 최대 변화율 제한
* 토큰 불일치 시 Action 차단

---

## L2 통합 흐름 요약

```text
[Physical World]
   ↓
[Encoder + Attention]
   ↓
[Phy_voc Tokens]
   ↓
[ErecRAM (Elastic Time Plane)]
   ↓
[LLM Narrative]
   ↓
[Intention → Action]
   ↓
[Physical World]
```

---

## 결론 (L2 수준에서의 보장)

* 시간 지연은 **보정 대상이 아닌 존재 변수**로 내재화됨
* 계체는 입력이 끊겨도 붕괴하지 않음
* LLM은 시스템을 **이해하지만 지배하지 못함**

→ **구현 가능한 존재 유지형 인공 계체 구조 완성**
